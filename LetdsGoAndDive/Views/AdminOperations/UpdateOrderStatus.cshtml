@model LetdsGoAndDive.Models.Order

<div class="container mt-4">
    <div class="card shadow-lg border-0 rounded-4">
        <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
            <h4 class="mb-0"><i class="bi bi-cash-stack me-2"></i> Update Order Status</h4>
            <a asp-action="AllOrders" class="btn btn-outline-light btn-sm">
                <i class="bi bi-arrow-left"></i> Back to Orders
            </a>
        </div>

        <div class="card-body p-4">
            <form asp-action="UpdateOrderStatus" method="post">
                <input type="hidden" name="Id" value="@Model.Id" />

                <div class="mb-3">
                    <label class="form-label fw-semibold">Order Status</label>
                    <select name="OrderStatusId" class="form-select form-select-lg" id="statusSelect">
                        <option value="">Select Order Status</option>
                        @foreach (var status in ViewBag.OrderStatusList as List<SelectListItem>)
                        {
                            <option value="@status.Value" selected="@(status.Selected ? "selected" : null)">
                                @status.Text
                            </option>
                        }
                    </select>
                </div>

                <!-- Delivery Link Input  -->
                <div class="mb-3" id="deliveryLinkContainer" style="display:none;">
                    <label class="form-label fw-semibold">Delivery Tracking Link</label>
                    <input type="text" name="DeliveryLink" class="form-control"
                           value="@Model.DeliveryLink"
                           placeholder="Enter delivery tracking link (e.g. https://jtexpress.ph/track?id=12345)" />

                    <div class="mb-3">
                        <label class="form-label">Delivery Fee</label>
                        <input type="number" class="form-control" name="DeliveryFee"
                               value="@Model.DeliveryFee" placeholder="Enter delivery fee (₱)" min="0" />
                    </div>


                    @if (!string.IsNullOrEmpty(Model.DeliveryLink))
                    {
                        <div class="mt-2">
                            <a href="@Model.DeliveryLink" target="_blank" class="btn btn-outline-primary btn-sm">
                                <i class="bi bi-box-seam"></i> View Current Delivery Link
                            </a>
                        </div>
                    }
                </div>

                <div class="text-end mt-4">
                    <button type="submit" class="btn btn-primary px-4">
                        <i class="bi bi-save"></i> Update
                    </button>
                </div>

                @if (TempData["msg"] != null)
                {
                    <div class="alert alert-info mt-3 text-center fw-semibold">
                        @TempData["msg"]
                    </div>
                }
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const statusSelect = document.getElementById("statusSelect");
            const deliveryLinkContainer = document.getElementById("deliveryLinkContainer");

            function toggleDeliveryLink() {
                const selectedText = statusSelect.options[statusSelect.selectedIndex]?.text?.toLowerCase();
                deliveryLinkContainer.style.display =
                    selectedText === "shipped" ? "block" : "none";
            }

            statusSelect.addEventListener("change", toggleDeliveryLink);
            toggleDeliveryLink(); // check on page load
        });
    </script>
}
